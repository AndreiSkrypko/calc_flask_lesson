"""
Файл: app.py
Это главный файл нашего Flask приложения - калькулятора.

В этом файле мы создаем веб-сервер, который:
1. Принимает запросы от пользователя
2. Выполняет математические операции
3. Возвращает результат обратно пользователю
"""

# Импортируем необходимые модули
# Flask - это фреймворк для создания веб-приложений на Python
from flask import Flask, render_template, request, jsonify

# Создаем экземпляр Flask приложения
# __name__ - это имя текущего модуля (app.py)
# Flask использует это, чтобы найти шаблоны и статические файлы
app = Flask(__name__)

# Настройка для отладки (в продакшене лучше отключить)
# Если True, сервер автоматически перезагружается при изменении кода
app.config['DEBUG'] = True


# Декоратор @app.route() говорит Flask, какой URL должен вызывать эту функцию
# '/' означает главную страницу (например, http://localhost:5000/)
# methods=['GET'] означает, что эта функция обрабатывает только GET запросы
@app.route('/', methods=['GET'])
def index():
    """
    Функция index() отображает главную страницу калькулятора.
    
    render_template() ищет файл 'index.html' в папке 'templates'
    и отображает его пользователю.
    """
    return render_template('index.html')


# Этот маршрут обрабатывает POST запросы на URL '/calculate'
# POST запросы используются для отправки данных на сервер
@app.route('/calculate', methods=['POST'])
def calculate():
    """
    Функция calculate() выполняет математические операции.
    
    Она получает данные от пользователя (числа и операцию),
    выполняет вычисление и возвращает результат.
    """
    try:
        # Получаем данные из запроса
        # request.json содержит данные, отправленные в формате JSON
        data = request.json
        
        # Извлекаем значения из данных
        # .get() безопасно получает значение, если ключ существует
        num1 = float(data.get('num1', 0))  # Первое число
        num2 = float(data.get('num2', 0))   # Второе число
        operation = data.get('operation', '+')  # Операция (+, -, *, /)
        
        # Выполняем операцию в зависимости от выбранной операции
        # Используем условные операторы для выбора правильной операции
        if operation == '+':
            result = num1 + num2  # Сложение
        elif operation == '-':
            result = num1 - num2  # Вычитание
        elif operation == '*':
            result = num1 * num2  # Умножение
        elif operation == '/':
            # Проверяем деление на ноль
            if num2 == 0:
                # Если делим на ноль, возвращаем ошибку
                return jsonify({
                    'success': False,
                    'error': 'Деление на ноль невозможно!'
                }), 400
            result = num1 / num2  # Деление
        else:
            # Если операция не распознана, возвращаем ошибку
            return jsonify({
                'success': False,
                'error': 'Неизвестная операция!'
            }), 400
        
        # Возвращаем успешный результат в формате JSON
        # jsonify() преобразует Python словарь в JSON формат
        return jsonify({
            'success': True,
            'result': result
        })
    
    except ValueError:
        # Обработка ошибки, если пользователь ввел не число
        return jsonify({
            'success': False,
            'error': 'Пожалуйста, введите корректные числа!'
        }), 400
    
    except Exception as e:
        # Обработка любых других ошибок
        return jsonify({
            'success': False,
            'error': f'Произошла ошибка: {str(e)}'
        }), 500


# Этот код выполняется только если файл запущен напрямую
# (а не импортирован как модуль)
if __name__ == '__main__':
    # Запускаем Flask сервер
    # host='0.0.0.0' - сервер будет доступен со всех сетевых интерфейсов
    # port=5000 - сервер будет работать на порту 5000
    # debug=True - включает режим отладки (автоперезагрузка при изменениях)
    app.run(host='0.0.0.0', port=5000, debug=True)
